<script src="./leaflet/leaflet.js"></script>

<script src="./heatmap/heatmap.min.js"></script>
<script src="./heatmap/leaflet-heatmap.js"></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
    integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
    crossorigin="" />



<script src="https://unpkg.com/sql.js@0.3.2/js/sql.js"></script>


<link rel="stylesheet" href="./mapstyles/mapstyle.css" />
<link rel="stylesheet" href="./leaflet-search/leaflet-search.css">

<script src="./marker-cluster/dist/leaflet.markercluster-src.js"></script>

<script src="./leaflet-search/leaflet-search.js"></script>

<script type="text/javascript" src="https://unpkg.com/leaflet.vectorgrid@1.2.0"></script>



<script type="text/javascript" src="./data/incidentdata.js"></script>
<script type="text/javascript" src="./data/municipaldata.js"></script>
<script type="text/javascript" src="./data/regionaldata.js"></script>
<script type="text/javascript" src="./data/provincialdata.js"></script>
<script type="text/javascript" src="./data/date.js"></script>
<script type="text/javascript" src="./data/coverage.js"></script>
<script type="text/javascript" src="./data/brgy.js"></script>

<div id="mapid">


    <div id="dimmedOverlay" onclick="modalClose()"></div>
    <div id="introModal" onclick="modalClose()">
        <img src="./icons/info.svg" class="infoicon "
            style="position: absolute; left:20;top:25; width: 25px;cursor:pointer;">

        <div class="modalTitle">
            Welcome to the Critical Events and Monitoring System <br> Map of COVID-19 Related Incidents!

        </div>


        <div>
            <p>
                In response to the COVID-19 situation, International Alert Philippines expanded its Critical Events
                Monitoring System (CEMS) to monitor tensions and violence related to the pandemic. The reports are
                visually presented through maps with the objective of not only information dissemination but also
                for data utilization in terms of programming among local governments to effectively respond to the
                tensions and pressures which may lead to violent conflict.
            </p>
        </div>

        <div>
            <h3>How to Use:</h3>
        </div>
        <div class="tutItem">
            <div style="float: left;width: 100px;">
                <img class="img-valign" src="./icons/tutlayers.png" style="width: 100px;">
            </div>
            <div style="float: left;width: 490px;"><span style="font-weight: bold;">Click</span> on the buttons on the
                control panel to switch to different map
                of overlays</div>



        </div>

        <div class="tutItem">
            <div style="float: left;width: 100px;">
                <img class="img-valign" src="./icons/tutmarkers.png" style="width: 100px;">
            </div>
            <div style="float: left;width: 490px;"><span style="font-weight: bold;">Check</span> the boxes to toggle the
                displayed reported incidents related to
                COVID-19</div>

        </div>


        <div class="tutItem">
            <div style="float: left;width: 100px;">
                <img class="img-valign" src="./icons/search.png" style="width: 100px;">
            </div>
            <div style="float: left;width: 490px;"><span style="font-weight: bold;">Type</span> in the box to search
                trough the data.</div>

        </div>

        <div class="tutItem">
            <div style="float: left;width: 100px;">
                <img class="img-valign" src="./icons/tutcontrol.png" style="width: 100px;">
            </div>
            <div style="float: left;width: 490px;"><span style="font-weight: bold;">Interact</span> with the map by
                zooming in or out, adjusting the overlay
                opacity, and changing basemaps.</div>

        </div>

        <div style="text-align: center;">
            <img class="img-valign" src="./icons/info.svg" style="height: 34px;padding-right: 20px;"><span>Click this
                icon located at the menu to see this tutorial again</span>
        </div>


        <div style="position: absolute;bottom: 1%;text-align: center;width: 93%;font-size: .8em;">
            Click anywhere to close
        </div>


    </div>


    <div id="mapControlPanel" onmouseover="disableMapInteraction()" onmouseout="enableMapInteraction()">
        <img src="./icons/info.svg" class="infoicon" title="Click to view the tutorial window"
            style="position: absolute; right:10;top:10; width: 20px;" onclick="modalOpen()">



        <div id="apptitle">
            <span style="font-size:22px;line-height: normal;font-weight: 600;" class="clickabletitle"> CRITICAL EVENTS
                MONITORING SYSTEM</span>
            <span style="font-size:20px;line-height: normal;font-weight: 300;"> MAP OF COVID-19 RELATED INCIDENTS</span>
        </div>



        <div id="boundaryPanel">
            <div style="width: 100%;margin: auto;width: 100%;" class="tooltip">
                <span style="font-size: 16px;padding:10px;" class="clickabletitle">Boundaries</span>
                <span class="tooltiptext">Administrative Boundaries of the Phillipines<br><br>Click on the buttons to
                    see regional, provincial, or municipal borders.</span>

            </div>

            <div id="locreg" class='boundarybutton bbleft' onclick="locButtonSelected(this)">Region</div>
            <div id="locprov" class='boundarybutton bbright' onclick="locButtonSelected(this)">Province</div>
            <div id="locmun" class='boundarybutton bbleft selected' onclick="locButtonSelected(this)">Municipality</div>
            <div id="locbrg" class='boundarybutton bbright' onclick="checkIfZoomed();">Barangay</div>
            <div id="locnone" class='boundarybutton bbleft' style="margin-left: 25%;" onclick="locButtonSelected(this)">
                None</div>

        </div>

        <div id="issuesPanel">



            <div style="width: 100%;" class="tooltip"><span class="clickabletitle "
                    style="font-size: 16px;padding:5px;margin: 5px;">CEMS
                    Incidents</span><br>
                <div style="font-size: 14px;padding:5px;margin-left: 5px;" id="cemsdate"></div>
                <span class="tooltiptext">These incidents were reported by ,asda</span>

            </div>


            <div style="margin:10px">
                <div style="float: left;">
                    <input class="img-valign" type="checkbox" id="tencbox" checked onclick="markerCheckBox()">
                    <img class="img-valign" src='./icons/yellow.png' style="width: 20px;">
                </div>
                <div style="float: left;width:70%;margin-left:5px;" class="clickabletitle tooltip">Tension
                    <span class="tooltiptext tooltiptextincident">Tooltip text</span>
                </div>
            </div>
            <p class="clear">&nbsp;</p>
            <div style="margin:10px">
                <div style="float: left;">
                    <input class="img-valign" type="checkbox" id="viocbox" checked onclick="markerCheckBox()">
                    <img class="img-valign" src='./icons/red.png' style="width: 20px;">



                </div>
                <div style="float: left;width:70%;margin-left:5px;" class="clickabletitle tooltip">Violence
                    <span class="tooltiptext tooltiptextincident">Tooltip text</span>
                </div>
            </div>
            <p class="clear">&nbsp;</p>


            <div style="margin:10px">
                <div style="float: left;">
                    <input class="img-valign" type="checkbox" id="respondentcbox" onclick="showCoverage()">
                    <img class="img-valign" src='./icons/coverage.png' style="width: 20px;">



                </div>
                <div style="float: left;width:70%;margin-left:5px;" class="clickabletitle tooltip">CEMS Coverage
                    <span class="tooltiptext tooltiptextincident">Tooltip text</span>
                </div>
            </div>
            <p class="clear">&nbsp;</p>


            <!-- 
            <div style="margin:10px">
                <div style="float: left;">
                    <img class="img-valign" src='./icons/cluster.png' style="width: 30px;">



                </div>
                <div style="float: left;width:70%;margin-left:5px;margin-top:10px;" class="clickabletitle tooltip">
                    Incident Count
                    <span class="tooltiptext tooltiptextincident">These numbered markers show how many individual
                        reports there are around the area.</span>
                </div>
            </div> -->

        </div>


        <div id="dohPanel">
            <div style="width: 100%;margin: auto;width: 100%;" class="tooltip">
                <span style="font-size: 16px;padding:5px;margin:5px;" class="clickabletitle" onclick="alert('a')">DOH
                    COVID-19 Cases</span>
                <br>
                <div style="font-size: 14px;padding:5px;margin-left: 5px;" id="dohdate"></div>

                <span class="tooltiptext">Tooltip text3 <br>asdasd</span>

            </div>
            <div id="dontshow" class='boundarybutton bbright selected' onclick="dohButtonSelected(this)">Don't show
            </div>

            <div id="show" class='boundarybutton bbright' onclick="dohButtonSelected(this)">Show
            </div>

        </div>


        <div id="panelfooter" style="margin-top:0px;display:flex;align-items:flex-end;justify-content: center;">

            <div>
                <a href="https://www.international-alert.org/" target="new">
                    <img src="./icons/alert-logo.png" width="60px">
                </a>
            </div>
            <div>
                <a href="https://www.dfat.gov.au/aid/australias-development-program" target="new">
                    <img src="./icons/ausaid.png" width="80px">
                </a>
            </div>


        </div>
        <div style="display:flex;align-items:flex-end;position: absolute;bottom: 10;right:10;">
            <div style="margin: 0px 5px 10px 0px;">
                <span>share this page on</span>
            </div>
            <div style="margin:5px;">
                <a target="new"
                    href="https://www.facebook.com/sharer/sharer.php?u=https://conflictalert.info/cems-covid-19-map/">
                    <img src="./icons/facebook.svg" width="25px" title="share on facebook">
                </a>
            </div>
            <div style="margin:5px;">
                <a target="new"
                    href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fconflictalert.info%2Fcems-covid-19-map%2F&text=Check%20this%20out!%20Critical%20Events%20Monitoring%20System%20-%20Map%20of%20COVID-19%20Related%20Incidents"
                    title="Tweet this page"><img src="./icons/twitter.svg" width="25px"></a>
            </div>

            <div style="margin:5px;">

                <a target="new"
                    href="https://www.linkedin.com/shareArticle?mini=true&url=https://conflictalert.info/cems-covid-19-map/&title=&summary=Critical Events Monitoring System - Map of COVID-19 Related Incidents&source="
                    title="share on linkedin"><img src="./icons/linkedin.svg" width="25px"></a>


            </div>

        </div>



    </div>

    <div id="mapControlIcon" onclick="hideicon()" onmouseover="disableMapInteraction()"
        onmouseout="enableMapInteraction()">
    </div>


    <!-- <div id="slidecontainerID" class="slidecontainer" onmouseover="disableMapInteraction()"
        onmouseout="enableMapInteraction()">
        <div class="clickabletitle tooltip">
            <img class="img-valign" src="./icons/opacity.png" style="height: 13.64px;"> <span>boundary opacity</span>
            <span class="tooltiptext tooltipopacity">Adjust the opacity of the boundary layer. <br><br> You can see more
                of the overlay by moving the slider to the left (-) and see more of the base map underneath by
                moving the slider to the right(+).</spam>
        </div>
        <div>
            <img class="img-valign" src="./icons/minus.png" style="margin-top:-13.64;height: 13.64px;"> <input
                type="range" min="0" max="100" value="30" class="slider" id="1myRange" style="width:129px;"> <img
                class="img-valign" src="./icons/plus.png" style="margin-top:-13.64;height: 13.64px;">
        </div>
    </div> -->


</div>


<script>
    //update the text display on as of for both sections
    updateDates();
    var mapOptions = {
        zoomControl: false,
        minZoom: 5,
        maxZoom: 15
    }

    var map = L.map('mapid', mapOptions).setView([14.5995, 120.9842], 5);

    disableMapInteraction();




    map.setMaxBounds(map.getBounds());
    map.setView([14.5995, 120.9842], 10);
    map.createPane('labels');
    map.createPane('markerspane');
    map.createPane('respondents');
    map.createPane('boundarypane').style.zIndex = 400;
    map.getPane('respondents').style.zIndex = 401;
    map.getPane('labels').style.zIndex = 500;
    map.getPane('markerspane').style.zIndex = 502;
    map.getPane('labels').style.pointerEvents = 'none';



    var currentstyle = {
        fillColor: 'white',
        weight: 2,
        opacity: .8,
        color: 'black',
        dashArray: '3',
        fillOpacity: 0
    };





    // initialize basemaps

    var positron = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
        attribution: '©OpenStreetMap, ©CartoDB'
    }).addTo(map);


    var positronLabels = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png', {
        attribution: '©OpenStreetMap, ©CartoDB',
        pane: 'labels'
    }).addTo(map);


    var CartoDB_DarkMatterNoLabels = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',

    });


    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    })

    var googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}&language=EN', {
        subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
    });

    var googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}&language=EN', {
        subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
    });

    var googleTerrain = L.tileLayer('http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}&language=EN', {
        subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
    });

    var googleHybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}&language=EN', {
        subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
    });


    var tensionMarkerGroup = new L.featureGroup({
        maxZoom: 10,
        pane: 'markerpane'
    });
    var violenceMarkerGroup = new L.featureGroup({
        pane: 'markerpane'
    });

    var baseMaps = {
        "Carto DB White": positron,
        "Carto DB Black": CartoDB_DarkMatterNoLabels,
        "Google Satellite (satellite image)": googleSat,
        "Google Streets (digitized and labeled)": googleStreets,
        "Google Terrain (digitized with elevation info)": googleTerrain
    };

    var overlays = {
        "Carto DB Labels": positronLabels
    }


    var vectorGrid = L.vectorGrid.slicer(brgy_daya, {
        maxZoom: 15,
        minZoom: 10,
        rendererFactory: L.svg.tile,
        vectorTileLayerStyles: {
            sliced: style1
        }
    });

    var municipalLayer = L.geoJson(municipaldata, {
        style: style1,
        onEachFeature: onEachFeature,
        pane: 'boundarypane'
    })

    var provincialLayer = L.geoJson(provincialdata, {
        style: style1,
        onEachFeature: onEachFeature,
        pane: 'boundarypane'
    })

    var regionalLayer = L.geoJson(regionaldata, {
        style: style1,
        onEachFeature: onEachFeature,
        pane: 'boundarypane'
    })


    // // add initial overlay 
    geojson = municipalLayer;
    geojson.addTo(map);

    var cfg = {
        // radius should be small ONLY if scaleRadius is true (or small radius is intended)
        // if scaleRadius is false it will be the constant radius used in pixels
        "useLocalExtrema": false,
        gradient: {
            // enter n keys between 0 and 1 here
            // for gradient color customization
            '0': '#FFC234',
            '1': '#FFC234'
        },
        "radius": .05,
        "maxOpacity": .8,
        // scales the radius based on map zoom
        "scaleRadius": true,
        // if set to false the heatmap uses the global maximum for colorization
        // if activated: uses the data maximum within the current map boundaries
        //   (there will always be a red spot with useLocalExtremas true)
        // which field name in your data represents the latitude - default "lat"
        latField: 'lat',
        // which field name in your data represents the longitude - default "lng"
        lngField: 'lng',
        // which field name in your data represents the data value - default "value"
        valueField: 'count'
    };


    var cfg2 = {
        // radius should be small ONLY if scaleRadius is true (or small radius is intended)
        // if scaleRadius is false it will be the constant radius used in pixels
        "useLocalExtrema": false,
        gradient: {
            // enter n keys between 0 and 1 here
            // for gradient color customization
            '0': '#A82C15',
            '1': '#A82C15'
        },
        "radius": .05,
        "maxOpacity": .8,
        // scales the radius based on map zoom
        "scaleRadius": true,
        // if set to false the heatmap uses the global maximum for colorization
        // if activated: uses the data maximum within the current map boundaries
        //   (there will always be a red spot with useLocalExtremas true)
        // which field name in your data represents the latitude - default "lat"
        latField: 'lat',
        // which field name in your data represents the longitude - default "lng"
        lngField: 'lng',
        // which field name in your data represents the data value - default "value"
        valueField: 'count'
    };



    var heatmapLayer = new HeatmapOverlay(cfg);
    var heatmapLayer2 = new HeatmapOverlay(cfg2);




    var IssueIcon = L.Icon.extend({
        options: {
            iconSize: [32, 42],
            popupAnchor: [0, -20]

        }
    });

    var greenIcon = new IssueIcon({
        iconUrl: './icons/green.png',
    })
    var yellowIcon = new IssueIcon({
        iconUrl: './icons/yellow.png',
    })
    var redIcon = new IssueIcon({
        iconUrl: './icons/red.png',
    })


    // Define an icon called cssIcon
    var cssIcon = L.divIcon({
        // Specify a class name we can refer to in CSS.
        className: 'css-icon',
        html: '<div class="gps_ring"></div>'
        // Set marker width and height
        , iconSize: [140, 140]
        // ,iconAnchor: [11,11]
    });


    var smallerIcon = L.divIcon({
        // Specify a class name we can refer to in CSS.
        className: 'css-icon',
        html: '<div class="smaller_gps_ring"></div>'
        // Set marker width and height
        , iconSize: [50, 50]
        // ,iconAnchor: [11,11]
    });

    // add markers




    // var markers = L.markerClusterGroup({
    //     disableClusteringAtZoom: 13,
    //     iconCreateFunction: function (cluster) {
    //         var violenceount = 0;
    //         var tensionscount = 0;
    //         var markers222 = cluster.getAllChildMarkers();

    //         markers222.forEach(element => {
    //             if (element.options.type == "Violence") {
    //                 violenceount++;
    //             } else {
    //                 tensionscount++;
    //             }
    //         });
    //         return L.divIcon({ html: '<div class=\'halfmarker\'>' + tensionscount + '<br><span class=\'violencecount\'>' + violenceount + '</span></div>', className: 'testclass' });
    //     }
    // });




    var arrayLength = incidentdata.length;

    var govIssues = [];
    var tenIssues = [];
    var vioIssues = [];

    var allIssues = [];

    //sort the incidents
    for (var i = 0; i < arrayLength; i++) {

        var temp;
        if (incidentdata[i].issue == 'Tensions') {
            tenIssues.push(incidentdata[i]);
            temp = yellowIcon;
        } else if (incidentdata[i].issue == 'Government/Private sector response') {
            govIssues.push(incidentdata[i]);
            temp = greenIcon;
        } else if (incidentdata[i].issue == 'Violence') {
            vioIssues.push(incidentdata[i]);
            temp = redIcon;
        }

        //Do something
    }





    var controlSearch = new L.Control.Search({
        position: 'topleft',
        layer: tensionMarkerGroup,
        initial: false,
        zoom: 18,
        marker: L.circleMarker([0, 0], { radius: 30 })
    }).addTo(map);

    var info = L.control();

    info.onAdd = function (map) {
        this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
        this.update({}, true);
        return this._div;
    };




    // method that we will use to update the control based on feature properties passed
    info.update = function (props, nothovering) {


        if (nothovering) {
            this._div.innerHTML = '<h4>Hover over an area</h4>';

        } else {
            if (currentstyle == style0) {

                this._div.innerHTML =
                    '<h4>Covid Cases (May 25, 2020)</h4>' +
                    (props ? '<h4>' + props.area + '</h4> ' : '') +
                    (props ? '' + props.covidcases + ' confirmed cases' : 'Hover over a an area');


            } else {
                this._div.innerHTML =
                    '<h4>Area</h4>' +
                    (props ? '<h4>' + props.area + '</h4> ' : '');

            }
        }
    };


    var legend = L.control({ position: 'topright' });

    legend.onAdd = function (map) {

        var div = L.DomUtil.create('div', 'info legend'),
            grades = [1, 25, 50, 100, 200, 500, 1000],
            labels = [];

        // loop through our density intervals and generate a label with a colored square for each interval
        for (var i = 0; i < grades.length; i++) {
            div.innerHTML +=
                '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
                grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
        }

        return div;
    };

    var legend2 = L.control({ position: 'topright' });

    legend2.onAdd = function (map) {

        var div = L.DomUtil.create('div', 'info legend'),
            grades = [1, 25, 50, 100, 200, 500, 1000],
            labels = [];

        // loop through our density intervals and generate a label with a colored square for each interval
        div.innerHTML = "Incident Count<br>0 &nbsp  &nbsp 2  &nbsp  &nbsp 5  &nbsp 10< <div id='gradient-legend'></div>";

        return div;
    };


    var legend3 = L.control({ position: 'topright' });

    legend3.onAdd = function (map) {

        var div = L.DomUtil.create('div', 'info legend');

        // loop through our density intervals and generate a label with a colored square for each interval
        div.innerHTML = "<div onmouseover='disableMapInteraction()' onmouseout='enableMapInteraction()'><img class='img-valign' src='./icons/opacity.png' style='height: 13.64px;'> <span>Heatmap Opacity</span><br><img class='img-valign' src='./icons/minus.png' style='margin-top:-13.64;height: 13.64px;'><input type='range' min='0' max='100' value='80' class='slider' id='myRange' style='width:129px;'><img class='img-valign' src='./icons/plus.png' style='margin-top:-13.64;height: 13.64px;'></div>";

        return div;
    };




    var legend4 = L.control({ position: 'topright' });

    legend4.onAdd = function (map) {

        var div = L.DomUtil.create('div', 'info legend');

        // loop through our density intervals and generate a label with a colored square for each interval
        div.innerHTML = "<div onmouseover='disableMapInteraction()' onmouseout='enableMapInteraction()'><img class='img-valign' src='./icons/opacity.png' style='height: 13.64px;'> <span>Boundary Opacity</span><br><img class='img-valign' src='./icons/minus.png' style='margin-top:-13.64;height: 13.64px;'><input type='range' min='0' max='100' value='0' class='slider' id='1myRange' style='width:129px;'><img class='img-valign' src='./icons/plus.png' style='margin-top:-13.64;height: 13.64px;'></div>";

        return div;
    };


    L.control.zoom({
        position: 'topright'
    }).addTo(map);

    L.control.layers(baseMaps, overlays, { position: 'topright' }).addTo(map);



    map.addControl(legend3);

    map.addControl(legend4);

    map.addControl(legend2);

    markerCheckBox();

    info.addTo(map);




    var slider = document.getElementById("myRange");

    slider.oninput = function () {
        var fillOpacity = this.value / 100
        document.getElementsByClassName("leaflet-overlay-pane")[0].style.opacity = fillOpacity.toString();

    }

    var slider = document.getElementById("1myRange");

    slider.oninput = function () {
        geojson.setStyle({

            fillOpacity: this.value / 100
        });

    }



    function showCoverage() {


        plotCoverage();

        var flag = document.getElementById("respondentcbox").checked;

        if (flag) {
            map.getPane('respondents').style.zIndex = 401;
            resGroup.addTo(map);

        } else {
            map.getPane('respondents').style.zIndex = 401;
            map.removeLayer(resGroup);
        }
    }

    function markerCheckBox() {
        allIssues = [];
        // Get the checkbox
        var tencheckBox = document.getElementById("tencbox");
        var viocheckBox = document.getElementById("viocbox");
        var govcheckBox = document.getElementById("govcbox");
        // Get the output text



        // If the checkbox is checked, display the output text
        if (tencheckBox.checked) {
            allIssues = allIssues.concat(tenIssues);
        }
        if (viocheckBox.checked) {
            allIssues = allIssues.concat(vioIssues);
        }

        if (tencheckBox.checked && viocheckBox.checked) {
            document.getElementById("gradient-legend").style.backgroundImage = "linear-gradient(90deg,rgba(0,0,0,.0), #FF6600)";
            createHeatMapLayer(tenIssues, vioIssues);


        } else if (tencheckBox.checked && !(viocheckBox.checked)) {
            document.getElementById("gradient-legend").style.backgroundImage = "linear-gradient(90deg,rgba(0,0,0,.0), #FFC234)";
            createHeatMapLayer(tenIssues, []);

        } else if (!(tencheckBox.checked) && viocheckBox.checked) {
            document.getElementById("gradient-legend").style.backgroundImage = "linear-gradient(90deg,rgba(0,0,0,.0), #A82C15)";
            createHeatMapLayer([], vioIssues);

        } else {
            createHeatMapLayer([], []);

        }



        tensionMarkerGroup.clearLayers();
        violenceMarkerGroup.clearLayers();

        createMarkers();
        hideMarkersOnZoom();

        // createHeatMapLayer(tenIssues, tenheatmapLayer);


    }




    function createMarkers() {

        for (var i = 0; i < allIssues.length; i++) {


            var temptitle = allIssues[i].barangay + " | " + allIssues[i].city + " | " + allIssues[i].municipality + " | " + allIssues[i].province + " | " + allIssues[i].issue;

            var markerOptions = {
                title: temptitle,
                radius: 5,
                fillColor: allIssues[i].color,
                color: "#000000",
                fillOpacity: 1,
                weight: 2,
                pane: 'markerspane',
                type: allIssues[i].issue

            };


            var town;
            if (allIssues[i].municipality != "") {
                town = allIssues[i].municipality
            } else {
                town = allIssues[i].city
            }
            var popuphtml =
                "<span class='popuplabel'>Date: </span>" + allIssues[i].date + "&nbsp&nbsp&nbsp&nbsp<span class='popuplabel'>Date Reported:</span> " + allIssues[i].datereported +
                "<br><span class='popuplabel'>Issue: </span>" + allIssues[i].issue + "<br>" +
                "<span class='popuplabel'>City/Municipality: </span>" + town + "<br>" +
                "<span class='popuplabel'>Details: </span>" + allIssues[i].details + "<br>"



            if (allIssues[i].issue == 'Tensions') {
                var marker = L.circleMarker(new L.LatLng(allIssues[i].lat, allIssues[i].lng), markerOptions);
                marker.bindPopup(popuphtml);
                tensionMarkerGroup.addLayer(marker);

                // } else if (allIssues[i].issue == 'Government/Private sector response') {
                //     var marker = L.circleMarker(new L.LatLng(allIssues[i].lat, allIssues[i].lng), markerOptions);
                //     marker.bindPopup(popuphtml);

            } else if (allIssues[i].issue == 'Violence') {
                var marker = L.circleMarker(new L.LatLng(allIssues[i].lat, allIssues[i].lng), markerOptions);
                marker.bindPopup(popuphtml);
                tensionMarkerGroup.addLayer(marker);

            }


        }

        map.addLayer(tensionMarkerGroup);
        // map.addLayer(violenceMarkerGroup);
        // map.addLayer(markers2);



        // map.addControl( new L.Control.Search({
        // 	url: 'https://nominatim.openstreetmap.org/search?format=json&q={s}',
        //     position:'topleft',
        // 	jsonpParam: 'json_callback',
        // 	propertyName: 'display_name',
        // 	propertyLoc: ['lat','lon'],
        // 	marker: L.circleMarker([0,0],{radius:30}),
        // 	autoCollapse: true,
        // 	autoType: false,
        // 	minLength: 5
        // }) );


    }




    function getColor(d) {
        //alert(d);
        return d > 1000 ? '#67340B' :
            d > 500 ? '#834311' :
                d > 200 ? '#964C15' :
                    d > 100 ? '#A45518' :
                        d > 50 ? '#B5651D' :
                            d > 25 ? '#C89C49' :
                                d > 1 ? '#FFEDA0'
                                    : '#FFFFFF';
    }


    function style0(feature) {
        var opacity

        if (document.getElementById("1myRange") != null) {
            opacity = document.getElementById("1myRange").value/ 100;
        } else {
            opacity = ".9";

        }
        return {
            fillColor: getColor(feature.properties.covidcases),
            weight: 2,
            opacity: .1,
            color: 'white',
            dashArray: '3',
            fillOpacity: opacity
        };
    }


    function style1() {

        var opacity
        if (document.getElementById("1myRange") != null) {
            opacity = document.getElementById("1myRange").value / 100;
        } else {
            opacity = "0";

        }

        return {
            fillColor: 'white',
            weight: 2,
            opacity: .8,
            color: 'black',
            dashArray: '3',
            fillOpacity: opacity
        };
    }



    function highlightFeature(e) {
        var layer = e.target;
        info.update(layer.feature.properties, false);
    }

    function resetHighlight(e) {

        temp = {
            covidcases: '- ',
            area: 'Hover over an Area'
        }
        info.update(temp, true);


    }

    function zoomToFeature(e) {
        map.fitBounds(e.target.getBounds());
    }

    function onEachFeature(feature, layer) {
        layer.on({
            mouseover: highlightFeature,
            mouseout: resetHighlight
        });
    }

    // zoomedOut.setOpacity(.5);//pwede icontrol


    function switchlayer(layer) {

        if (map.hasLayer(geojson)) {
            map.removeLayer(geojson)
        }

        if (map.hasLayer(vectorGrid)) {
            map.removeLayer(vectorGrid);
        }

        if (layer == 'locnone') {
            document.getElementById('show').classList.remove('selected');
            document.getElementById('dontshow').classList.add('selected');
            currentstyle = style1
            map.removeControl(legend);

        } else if (layer == 'locreg') {
            regionalLayer.setStyle(currentstyle);
            regionalLayer.addTo(map);
            geojson = regionalLayer;

        } else if (layer == 'locmun') {
            municipalLayer.setStyle(currentstyle);
            municipalLayer.addTo(map);
            geojson = municipalLayer;

        } else if (layer == 'locprov') {
            provincialLayer.setStyle(currentstyle);
            provincialLayer.addTo(map);
            geojson = provincialLayer;

        } else if (layer = 'locbrg') {
            vectorGrid.addTo(map);
        }


    }


    function removeSelected() {
        document.getElementById('dontshow').classList.remove('selected');
        document.getElementById('show').classList.remove('selected');

    }

    function removeLoCSelected() {
        document.getElementById('locreg').classList.remove('selected');
        document.getElementById('locprov').classList.remove('selected');
        document.getElementById('locmun').classList.remove('selected');
        document.getElementById('locbrg').classList.remove('selected');
        document.getElementById('locnone').classList.remove('selected');
    }

    function setSelected(id) {
        document.getElementById(id).classList.add('selected');
    }


    function dohButtonSelected(t) {
        removeSelected();
        setSelected(t.id);
        if (t.id == 'dontshow') {
            currentstyle = style1
            map.removeControl(legend);
        }
        else {
            currentstyle = style0

            map.addControl(legend);
        }
        geojson.setStyle(currentstyle);
    }





    function locButtonSelected(t) {

        if (t.id == "dontshow") {

            geojson.setStyle(style1);
            map.removeControl(legend);
            map.removeControl(info);
            removeLoCSelected();
            setSelected(t.id);

        } else {
            removeLoCSelected()
            // map.addControl(info);
            // map.addControl(legend);
            switchlayer(t.id);
            setSelected(t.id);
        }
    }


    function enableMapInteraction() {

        map.dragging.enable();
        map.touchZoom.enable();
        map.doubleClickZoom.enable();
        map.scrollWheelZoom.enable();
        map.boxZoom.enable();
        map.keyboard.enable();


    }

    function disableMapInteraction() {

        map.dragging.disable();
        map.touchZoom.disable();
        map.doubleClickZoom.disable();
        map.scrollWheelZoom.disable();
        map.boxZoom.disable();
        map.keyboard.disable();


    }

    function modalClose() {
        enableMapInteraction()

        document.getElementById('dimmedOverlay').classList.add('hiddenmodal');
        document.getElementById('introModal').classList.add('hiddenmodal');

    }

    function modalOpen() {

        disableMapInteraction();

        document.getElementById('dimmedOverlay').classList.remove('hiddenmodal');
        document.getElementById('introModal').classList.remove('hiddenmodal');

    }

    function updateDates() {
        document.getElementById('cemsdate').innerHTML = incidentAsOfDate;
        document.getElementById('dohdate').innerHTML = incidentAsOfDate;

    }



    function arrangeIssuesData(data) {
        var heatMapData = { max: 10, data: [{}] };
        for (let index = 0; index < data.length; index++) {
            const element = data[index];

            heatMapData.data[index] = { lat: data[index].lat, lng: data[index].lng, count: 1 }

        }


        return heatMapData;
    }


    function createHeatMapLayer(tensiondata, violencedata) {

        map.removeLayer(heatmapLayer);
        this.heatmapLayer = new HeatmapOverlay(cfg);

        map.removeLayer(heatmapLayer2);
        this.heatmapLayer2 = new HeatmapOverlay(cfg2);

        if (tensiondata.length > 0) {

            heatmapLayer.setData(arrangeIssuesData(tensiondata));
            heatmapLayer.addTo(map);

        }


        if (violencedata.length > 0) {

            heatmapLayer2.setData(arrangeIssuesData(violencedata));
            heatmapLayer2.addTo(map);

        }

        // enable event forwarding
    }



    var resGroup = L.layerGroup();

    function plotCoverage() {

        var iconSize = smallerIcon;

        for (let i = 0; i < coverage.length; i++) {

            var markerOptions = {
                icon: iconSize,
                radius: 10

            }
            L.marker([coverage[i].lat, coverage[i].lng], markerOptions).addTo(resGroup);

        }


    }


    // change CFG on marker check/uncheck

    function hideMarkersOnZoom() {

        var zoom = map.getZoom();
        if (zoom <= 9 && map.hasLayer(tensionMarkerGroup)) {
            map.removeLayer(tensionMarkerGroup);
            cfg.radius = 0.15;
            cfg2.radius = 0.15;


        }
        if (zoom > 9 && map.hasLayer(tensionMarkerGroup) == false) {
            map.addLayer(tensionMarkerGroup);
            cfg.radius = 0.15 - (zoom / 100);
            cfg2.radius = 0.15 - (zoom / 100);

        }
        if (zoom <= 9 && map.hasLayer(violenceMarkerGroup)) {
            map.removeLayer(violenceMarkerGroup);
            cfg.radius = 0.15;
            cfg2.radius = 0.15;


        }
        if (zoom > 9 && map.hasLayer(violenceMarkerGroup) == false) {
            map.addLayer(violenceMarkerGroup);
            cfg.radius = 0.15 - (zoom / 100);
            cfg2.radius = 0.15 - (zoom / 100);

        }



    }

    function resizeCircleradius() {

        if (map.hasLayer(resGroup)) {

            if (map.getZoom() < 9) {
                resGroup.eachLayer(function (layer) {
                    return layer.setIcon(smallerIcon);

                })

            } else {
                resGroup.eachLayer(function (layer) {
                    return layer.setIcon(cssIcon);

                })


            }
        }
    }


    function adjustAdminborders() {
        var zoom = map.getZoom();
        var weight = 1;
        if (zoom >= 9) {
            weight = 2;
        }
        geojson.setStyle({
            weight: weight
        });


    }

    function switchFromBrgyOnZoom() {
        var zoom = map.getZoom();
        if (zoom >= 9) {
            locButtonSelected(document.getElementById('locmun'));
        }

    }


    function checkIfZoomed() {
        if (map.getZoom() >= 9) {
            locButtonSelected(document.getElementById('locbrg'));

        }

    }

    function disableBrgy() {
        var zoom = map.getZoom();

        if (zoom < 9) {
            document.getElementById('locbrg').classList.add("disabledButton");
        } else {

            document.getElementById('locbrg').classList.remove("disabledButton");
        }
    }

    function adjustMarkers() {

        hideMarkersOnZoom();
        plotCoverage();
        adjustAdminborders();
        switchFromBrgyOnZoom();
        disableBrgy();
        resizeCircleradius();



    }


    map.on('zoomend', adjustMarkers);





</script>